# Тестовое задание ООО "Муниципальные решения"
## Цыкунов Александр

### Выполненные требования
1. Добавил имя и фамилию разработчика на главной странице
2. Исправил ошибку, при которой авторизация нового пользователя происходит независимо от того подтвержден email пользователя или нет. При авторизации неактивированного пользователя ему выводится соответствующее предупреждение с сылкой на повторную отправку письма для активации.
3. Исправил искажение аватарки при отображении в списке пользователей, если исходная картинка не является квадратной. Поскольку необходимо было использовать plupload, то в качестве решения проблемы помимо аватарки загружалась ее обрезанная до 60 на 60 версия, которая в дальнейшем использовалась для картинки в списке пользователей.  
4. Создал favicon для проекта. Можно сделать и различные разрешения для иконок с использованием атрибута sizes, иконки для плиток в Windows с использованием browserconfig.xml, добавить manifest.json для Android Chrome. Для всего многообразия иконок можно воспользоваться помощником, к примеру http://realfavicongenerator.net/.
5. Для того, чтобы определить онлайн пользователь или нет, необходимо отслеживать его активность. Первым делать отслеживать его переходы по страницам ресурса. Для упрощения и централизации этого была сделана политика setOnline. Пользователь также может быть на одной странице долгое время, для этого случая необходимо раз в какое-то время пинговать сервер, говоря ему, что мы еще онлайн. При выходе необходимо фиксировать, что пользователь оффлайн. Поскольку может быть ситуация, при которой пользователь станет оффлайн, а сервер не зафиксирует это, то необходимо запускать скрипт по крону, который будет отслеживать пользователей со статусом онлайн, но последнее время активности превышает необходимое значение и выставлять их в оффлайн. Если пользователь онлайн, то в правом нижнем углу аватары или аватар списков отображается зеленый круг. При смене статуса происходит уведомление всех активных пользователей об этом событии средствами работы с web-сокетами.
6. Если пользователь online, то при просмотре его профиля другим пользователем он видет на карте место положения пользователя с маркером зеленого цвета. Если пользователь offline, то отображать на карте точку его последнего пребывания маркером красного цвета. Если не возможно установить текущее положение (пользователь отключил эту возможность), то справа вверху над картой появляется иконка серого цвета и если есть предыдущие координаты, то они отображаются на карте маркером серого цвета. При смене координат, статуса или запрета на определение координат всем друзьям рассылается уведомление об этом средствами работы с web-сокетами.
7. Сделал доступным просмотр профиля пользователя с user/\<username\> и user/\<id\>
8. Реализовал просмотр профилей друзей из списка. При попытке просмотреть профиль пользователя, не являющегося другом, путем явного указания url его профиля, выводится сообщение о невозможности просмотра данной информации. Разделил шаблоны профилей для владельца профиля и друга, унаследовав их от одного шаблона
9. Реализовал обмен сообщениями между друзьями. Под аватарой ссылка на мессенджер. Слева список друзей, содержащий последнее сообщение и количество непрочитанных сообщений в диалоге, справа переписка. Мессенджер работает без перезагрузки страницы. Происходит уведомление контакта, с котором ведется переписка средствами работы с web-сокетами. Если он в этот момент в мессенджере, то добавляется сообщение в диалог, изменяется последнее сообщение с списке контактов и счетчик непрочитанных сообщений. Если контакт находится в профиле, то увеличивается счетчик непрочитанных сообщений и всплывает нотификация в правом нижнем углу с сообщением, при нажатии на аватару которого открывается мессенджер с данным контактом, при нажатии на остальную часть - закрытие уведомления.

### Дополнительно
1. Отправка письма для активации пользователя вынесена в отдельный сервис
2. Исправлена ошибка, которая возникала при введении незарегистрированного логина
3. Исправлена ошибка, возникающая при попытке открыть профиль несуществующего пользователя

### Необходимые доработки
1. В письме, отвечающем за активацию аккаунта использовать токен, который не содержит в себе пароль ни в каком виде. Ссылка остается в письме, в истории браузера, а базы хешей в интернете достаточно активно пополняются.
2. Быть может лучше передавать средствами plupload оригинальное изображение, отресайзенное до разумных пределов, а обрезание делать на сервере, скажем sails-service-image и предоставить пользователю возможность самому выбирать область обрезания исходного изображения.
3. Сообщения об ошибках выводить поверх форм, к примеру при неудачной попытке авторизации потом нет формы для повторного ввода логина и пароля
4. Автовход и восстановление пароля
5. В firefox при ответе res.ok(); выдается элемент не найден из-за пустого ответа (необходимо выставлять правильный тип или что-то передавать)
6. Использовать кэширование частовостребованных данных, например в redis
7. Сделать все на ajax без перезагрузок страниц в виде json, а на стороне клиента рендерить (jsrender), либо использовать angularJS
8. Использовать транзакции при таких операциях, как вставка сообщения, дабы счетчики были валидными при нештатных ситуациях
9. При усложнении и разростании проекта увеличивается вложенность callback функций, поэтому имеет смысл подумать о promises.
10. Для списка друзей и сообщений использовать постраничную автоподгрузку

### Предложения
1. Поскольку у нас имеются данные о статусе онлайн/оффлайн, координаты, можно реализовать локальные комнаты пользователей, которые находятся в определенном радиусе
2. На основании данных о положении реализовать различную интересную статистическую информацию, вроде любимые места и тд.
3. Отображать на карте различные рекламные предложения от магазинов и сервисов по типу Avito.
4. Сообщения о различных мероприятиях с отображеним на карте места их проведения (концерты, спортивные состязания и тд).
5. Поиск людей по заранее указанным интересам, готовых к встрече с отображением их координат.
